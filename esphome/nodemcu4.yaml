substitutions:
  devicename: nodemcu4
  friendly_name: Nodemcu 4
  room: KÃ¼che
  update_interval_short: 2min
  update_interval_long: 10min
esphome:
  name: ${devicename}
  platform: ESP8266
  board: nodemcuv2
time: !include shared/time.yaml
wifi: !include shared/wifi.yaml
api: !include shared/api.yaml
ota: !include shared/ota.yaml
web_server: !include shared/webserver.yaml
captive_portal:
logger:
sensor:
  - platform: wifi_signal
    name: ${friendly_name} (${room}) WiFi Signal
    update_interval: ${update_interval_long}
    unit_of_measurement: dB
    icon: mdi:wifi
  - platform: adc
    pin: A0
    update_interval: ${update_interval_short}
    name: ${friendly_name} (${room}) Audio Meter
    filters:
      - multiply: 3.3
    unit_of_measurement: dB
binary_sensor:
  - platform: gpio
    pin: D4
    device_class: motion
    name: ${friendly_name} (${room}) Doppler Sensor
    id: ${devicename}_doppler
    filters:
      - delayed_off: 2s
      - delayed_on: 200ms
  - platform: gpio
    pin: D3
    device_class: sound
    name: ${friendly_name} (${room}) Noise Sensor
    id: ${devicename}_sound
    filters:
      - delayed_off: 120s
  - platform: gpio
    pin: D0
    id: ${devicename}_motion
    name: ${friendly_name} (${room}) Motion Sensor
    device_class: motion
  - platform: template
    id: ${devicename}_templ_motion
    internal: true
    lambda: 'return id(${devicename}_motion).state;'
#    filters:
#      - delayed_off: 3min
#    on_press:
#      - homeassistant.service:
#          service: switch.turn_on
#          data:
#            entity_id: switch.schalter_1_flur_relay
#    on_release:
#      - homeassistant.service:
#          service: switch.turn_off
#          data:
#            entity_id: switch.schalter_1_flur_relay
  - platform: template
    id: ${devicename}_templ_doppler
    internal: true
    lambda: 'return id(${devicename}_doppler).state;'
    filters:
      - delayed_off: 3min
    on_press:
      - homeassistant.service:
          service: switch.turn_on
          data:
            entity_id: switch.schalter_1_flur_relay
    on_release:
      - homeassistant.service:
          service: switch.turn_off
          data:
            entity_id: switch.schalter_1_flur_relay
  - platform: status
    device_class: connectivity
    name: ${friendly_name} (${room}) Status
switch:
  - platform: restart
    name: ${friendly_name} (${room}) Restart
