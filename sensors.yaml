#███████╗███████╗███╗   ██╗███████╗ ██████╗ ██████╗ ███████╗
#██╔════╝██╔════╝████╗  ██║██╔════╝██╔═══██╗██╔══██╗██╔════╝
#███████╗█████╗  ██╔██╗ ██║███████╗██║   ██║██████╔╝███████╗
#╚════██║██╔══╝  ██║╚██╗██║╚════██║██║   ██║██╔══██╗╚════██║
#███████║███████╗██║ ╚████║███████║╚██████╔╝██║  ██║███████║
#╚══════╝╚══════╝╚═╝  ╚═══╝╚══════╝ ╚═════╝ ╚═╝  ╚═╝╚══════╝
#
- platform: influxdb
  host: !secret influx_host # pragma: allowlist secret
  port: !secret influx_port # pragma: allowlist secret
  username: !secret influx_usr # pragma: allowlist secret
  password: !secret influx_pwd # pragma: allowlist secret
  queries:
    - name: InfluxDB Size Internal
      unit_of_measurement: MB
      group_function: mean
      value_template: "{{ (value | float / 1024 / 1024) | round(1) }}"
      measurement: '"monitor"."shard"'
      where: "time > now() - 15m"
      database: _internal
      field: diskBytes
    - name: InfluxDB Size UniFi
      unit_of_measurement: MB
      group_function: mean
      value_template: "{{ (value | float / 1024 / 1024) | round(1) }}"
      measurement: '"monitor"."shard"'
      where: '"database"=''unifi'' AND time > now() - 15m'
      database: _internal
      field: diskBytes
    - name: InfluxDB Size Homeassistant
      unit_of_measurement: MB
      group_function: mean
      value_template: "{{ (value | float / 1024 / 1024) | round(1) }}"
      measurement: '"monitor"."shard"'
      where: '"database"=''homeassistant'' AND time > now() - 15m'
      database: _internal
      field: diskBytes
    - name: Average Power (last hour)
      database: homeassistant
      where: '"entity_id" = ''energy_combined_power'' AND time >= now() - 1h'
      measurement: '"W"'
      value_template: "{{ value | round(2) }}"
      unit_of_measurement: W
    - name: Average Power (last day)
      database: homeassistant
      where: '"entity_id" = ''energy_combined_power'' AND time >= now() - 24h'
      measurement: '"W"'
      value_template: "{{ value | round(2) }}"
      unit_of_measurement: W
    - name: Average Power (last week)
      database: homeassistant
      where: '"entity_id" = ''energy_combined_power'' AND time >= now() - 7d'
      measurement: '"W"'
      value_template: "{{ value | round(2) }}"
      unit_of_measurement: W
#    - name: Heating Wohnzimmer (last hour)
#      database: homeassistant
#      where: 'time > now() - 1h AND time < now() AND "entity_id" = ''heating_time_wohnzimmer'''
#      measurement: '"min"' 
#      value_template: "{{ value | round(2) }}"
#      unit_of_measurement: min
#    - name: Heating Wohnzimmer (past 24hrs)
#      database: homeassistant
#      where: 'time > now() - 24h AND time < now() AND "entity_id" = ''heating_time_wohnzimmer'''
#      measurement: '"min"'
#      value_template: "{{ value | round(2) }}"
#      unit_of_measurement: min
#    - name: Heating Wohnzimmer (past 7 days)
#      database: homeassistant
#      where: 'time > now() - 7d AND time < now() AND "entity_id" = ''heating_time_wohnzimmer'''
#      measurement: '"min"'
#      value_template: "{{ value | round(2) }}"
#      unit_of_measurement: min
#    - name: Heating Wohnzimmer (past 30 days)
#      database: homeassistant
#      where: 'time > now() - 30d AND time < now() AND "entity_id" = ''heating_time_wohnzimmer'''
#      measurement: '"min"'
#      value_template: "{{ value | round(2) }}"
#      unit_of_measurement: min
#    - name: Heating Wohnzimmer (past year)
#      database: homeassistant
#      where: 'time > now() - 365d AND time < now() AND "entity_id" = ''heating_time_wohnzimmer'''
#      measurement: '"min"'
#      value_template: "{{ value | round(2) }}"
#      unit_of_measurement: min
- platform: sql
  scan_interval: 86400 # 24h
  db_url: !secret dburl # pragma: allowlist secret
  queries:
    - name: MariaDB Homeassistant
      query: 'SELECT table_schema "database", Round(Sum(data_length + index_length) / 1024 / 1024 / 1024, 2) "value" FROM information_schema.tables WHERE table_schema="hassio" GROUP BY table_schema;'
      column: "value"
      unit_of_measurement: GB
    - name: MariaDB States recorded today
      query: "SELECT COUNT(*) as value FROM states WHERE created BETWEEN CURDATE() AND adddate(current_date, 1) LIMIT 1;"
      column: "value"
      unit_of_measurement: States
    - name: MariaDB States recorded yesterday
      query: "SELECT COUNT(*) as value FROM states WHERE created BETWEEN subdate(current_date, 1) and CURDATE() LIMIT 1;"
      column: "value"
      unit_of_measurement: States
    - name: MariaDB Total states stored
      query: "SELECT COUNT(*) as value FROM states;"
      column: "value"
      unit_of_measurement: States
    - name: MariaDB Unique Entity IDs
      query: "SELECT count(DISTINCT entity_id) as value FROM states;"
      column: "value"
      unit_of_measurement: Entities
    - name: MariaDB Newest Entity ID
      query: "SELECT entity_id, min(last_updated) as last_state FROM states GROUP BY entity_id ORDER BY last_state DESC LIMIT 1;"
      column: "entity_id"
    - name: MariaDB Most Updated Entity ID
      query: "SELECT entity_id, count(*) as count, max(last_updated), min(last_updated) FROM states GROUP BY entity_id ORDER BY count DESC LIMIT 1;"
      column: "entity_id"
- platform: version
  image: qemux86-64
  source: local
- platform: systemmonitor
  resources:
    - type: disk_use_percent
      arg: /
    - type: memory_free
    - type: swap_use_percent
    - type: load_1m
    - type: load_5m
    - type: load_15m
    - type: processor_use
    - type: last_boot
    - type: throughput_network_in
      arg: eth0
    - type: throughput_network_out
      arg: eth0
    - type: network_in
      arg: eth0
    - type: network_out
      arg: eth0
- platform: integration
  source: sensor.sonoff_pow_r2_whz_power
  name: energy_consumption_whz_1
  unit_prefix: k
  round: 2
- platform: integration
  source: sensor.sonoff_pow_r2_tv_power
  name: energy_consumption_whz_2
  unit_prefix: k
  round: 2
- platform: integration
  source: sensor.energy_combined_power
  name: energy_consumption_combined
  unit_prefix: k
  round: 2
- platform: command_line
  scan_interval: 300
  unit_of_measurement: pending update(s)
  name: System Updates
  command: "cat /config/sys_updates.log"
- platform: command_line
  scan_interval: 300
  unit_of_measurement: pending update(s)
  name: Security Updates
  command: "cat /config/sec_updates.log"
- platform: dnsip
  hostname: !secret home_host # pragma: allowlist secret
  name: !secret home_host # pragma: allowlist secret
  resolver: 1.1.1.1
- platform: reddit
  username: !secret reddit_username # pragma: allowlist secret
  password: !secret reddit_password # pragma: allowlist secret
  client_id: !secret reddit_client_id # pragma: allowlist secret
  client_secret: !secret reddit_client_secret # pragma: allowlist secret
  subreddits:
    - gamedealsfree
  sort_by: new
- platform: feedparser
  name: !secret feed_1_name # pragma: allowlist secret
  feed_url: !secret feed_1_url # pragma: allowlist secret
  inclusions:
    - title
    - link
    - pubDate
  exclusions:
    - image
- platform: feedparser
  name: !secret feed_2_name # pragma: allowlist secret
  feed_url: !secret feed_2_url # pragma: allowlist secret
  inclusions:
    - title
    - link
    - pubDate
    - description
  exclusions:
    - image
- platform: feedparser
  name: RSS Destiny Glitch
  feed_url: "https://www.reddit.com/r/raidsecrets/search.rss?q=flair%3AGlitch&restrict_sr=on&include_over_18=on&sort=new&t=all.rss"
  inclusions:
    - title
    - link
    - pubDate
- platform: feedparser
  name: RSS Destiny Datamine
  feed_url: "https://www.reddit.com/r/raidsecrets/search.rss?q=flair%3ADatamine&restrict_sr=on&include_over_18=on&sort=new&t=all.rss"
  inclusions:
    - title
    - link
    - pubDate
- platform: feedparser
  name: RSS Destiny SGA
  feed_url: "https://www.reddit.com/r/DestinyTheGame/search.rss?q=flair%3ASGA&restrict_sr=on&include_over_18=on&sort=new&t=all.rss"
  inclusions:
    - title
    - link
    - pubDate
- platform: feedparser
  name: RSS Destiny Guide
  feed_url: "https://www.reddit.com/r/DestinyTheGame/search.rss?q=flair%3AGuide&restrict_sr=on&include_over_18=on&sort=new&t=all.rss"
  inclusions:
    - title
    - link
    - pubDate
- platform: feedparser
  name: Free Game Keys
  feed_url: "https://www.reddit.com/r/GameDeals/search.rss?q=subreddit:GameDeals%20AND%20title:(%22free%22%20OR%20%22100%%22%20OR%20%22$0.00%22%20OR%20%22Giveaway%22%20NOT%20%22IndieBox%22%20NOT%20%22nintendo%22%20NOT%20%22fanatical%22%20NOT%20%22itchio%22%20NOT%20%22itch.io%22%20NOT%20%22IndieGala%22%20NOT%20%22Groupees%22)&restrict_sr=&include_over_18=on&sort=new&t=all.rss"
  inclusions:
    - title
    - link
    - pubDate
  exclusions:
    - image
- platform: feedparser
  name: rss haveibeenpwnd
  feed_url: "http://feeds.feedburner.com/HaveIBeenPwnedLatestBreaches"
  inclusions:
    - title
    - link
    - pubDate
  exclusions:
    - image
- platform: feedparser
  name: rss coindesk
  feed_url: "https://www.coindesk.com/feed"
  inclusions:
    - title
    - link
    - pubDate
  exclusions:
    - image
- platform: feedparser
  name: RSS homeassistant alerts
  feed_url: "https://alerts.home-assistant.io/feed.xml"
  inclusions:
    - title
    - link
    - pubDate
- platform: feedparser
  name: GitHub Newsfeed
  feed_url: !secret feed_github_news # pragma: allowlist secret
  inclusions:
    - title
    - link
    - pubDate
- platform: feedparser
  name: !secret feed_joboffers_sz_name # pragma: allowlist secret
  feed_url: !secret feed_joboffers_sz_url # pragma: allowlist secret
  inclusions:
    - title
    - link
    - pubDate
- platform: feedparser
  name: !secret feed_joboffers_gh_name # pragma: allowlist secret
  feed_url: !secret feed_joboffers_gh_url # pragma: allowlist secret
  inclusions:
    - title
    - link
    - pubDate
- platform: places
  name: Martin
  devicetracker_id: device_tracker.google_pixel
  #  options: zone,place,street_number,street,city,state,postal_code
  options: do_not_reorder, place_name, street_number, street, city, postal_code
  map_provider: google
  #  map_zoom: 19
  home_zone: zone.home
  api_key: !secret email_phixion # pragma: allowlist secret
- platform: rest
  resource: https://api.myip.com
  name: External IP
  value_template: "{{ value_json.ip }}"
- platform: rest
  resource: !secret supervisor_rest_api
  name: core
  unit_of_measurement: "%"
  value_template: "{{ value_json.data.cpu_percent }}"
  scan_interval: 10
  headers:
    Authorization: !secret llt
    Content-Type: application/json
  json_attributes_path: "$.data"
  json_attributes:
    - memory_percent
- platform: rest
  resource: !secret supervisor_rest_api
  name: supervisor
  unit_of_measurement: "%"
  value_template: "{{ value_json.data.cpu_percent }}"
  scan_interval: 10
  headers:
    Authorization: !secret llt
    Content-Type: application/json
  json_attributes_path: "$.data"
  json_attributes:
    - memory_percent
- platform: authenticated
  provider: ipapi
  enable_notification: true
- platform: uptime
#  unit_of_measurement: days
- platform: mvglive
  nextdeparture:
    - station: !secret station_mvg_tram # pragma: allowlist secret
      destinations: !secret destination_tram # pragma: allowlist secret
      name: Tram
      lines: !secret line_tram # pragma: allowlist secret
      products: ["Tram", "Nachteule"]
      number: 3
    - station: !secret station_mvg_bus # pragma: allowlist secret
      destinations: !secret destination_bus # pragma: allowlist secret
      name: Bus
      lines: !secret line_bus # pragma: allowlist secret
      products: ["Bus"]
      number: 3
    - station: !secret station_mvg_u # pragma: allowlist secret
      name: U-Bahn
      directions: ["2"]
      products: ["U-Bahn"]
      number: 3
- platform: unifigateway
  host: !secret unifigw_host # pragma: allowlist secret
  port: !secret unifigw_port # pragma: allowlist secret
  username: !secret unifigw_user # pragma: allowlist secret
  password: !secret unifigw_pwd # pragma: allowlist secret
  monitored_conditions:
    - www
    - wlan
    - alerts
    - firmware
  site_id: !secret unifigw_site # pragma: allowlist secret
  verify_ssl: false
- platform: template
  sensors:
    climate_wohnung_temp:
      friendly_name: Wohnung
      unit_of_measurement: "°C"
      device_class: temperature
      value_template: "{{ states.climate.alle_thermostate.attributes.current_temperature | default(0) | int if states.climate.alle_thermostate.attributes.current_temperature is not none }}"
    climate_flur_temp:
      friendly_name: Flur
      unit_of_measurement: "°C"
      device_class: temperature
      value_template: "{{ states.climate.wiser_flur.attributes.current_temperature | default(0) | int if states.climate.wiser_flur.attributes.current_temperature is not none }}"
    climate_bad_temp:
      friendly_name: Bad
      unit_of_measurement: "°C"
      device_class: temperature
      value_template: "{{ states.climate.wiser_bad.attributes.current_temperature | default(0) | int if states.climate.wiser_bad.attributes.current_temperature is not none }}"
    climate_wohnzimmer_temp:
      friendly_name: Wohnzimmer
      unit_of_measurement: "°C"
      device_class: temperature
      value_template: "{{ states.climate.wiser_wohnzimmer.attributes.current_temperature | default(0) | int if states.climate.wiser_wohnzimmer.attributes.current_temperature is not none }}"
    climate_wohnung_target_temp:
      friendly_name: Target Temp Wohnung
      unit_of_measurement: "°C"
      device_class: temperature
      value_template: "{{ states.climate.alle_thermostate.attributes.temperature | default(0) | int if states.climate.alle_thermostate.attributes.temperature is not none }}"
    climate_flur_target_temp:
      friendly_name: Target Temp Flur
      unit_of_measurement: "°C"
      device_class: temperature
      value_template: "{{ states.climate.wiser_flur.attributes.temperature | default(0) | int if states.climate.wiser_flur.attributes.temperature is not none }}"
    climate_bad_target_temp:
      friendly_name: Target Temp Bad
      unit_of_measurement: "°C"
      device_class: temperature
      value_template: "{{ states.climate.wiser_bad.attributes.temperature | default(0) | int if states.climate.wiser_bad.attributes.temperature is not none }}"
    climate_wohnzimmer_target_temp:
      friendly_name: Target Temp Wohnzimmer
      unit_of_measurement: "°C"
      device_class: temperature
      value_template: "{{ states.climate.wiser_wohnzimmer.attributes.temperature | default(0) | int if states.climate.wiser_wohnzimmer.attributes.temperature is not none }}"
    unifi_speedtest_rx:
      #      entity_id: sensor.unifi_gateway_www
      friendly_name: Download
      unit_of_measurement: MB/s
      value_template: "{{ state_attr('sensor.unifi_gateway_www','xput_down') | default(0) }}"
    unifi_speedtest_tx:
      #      entity_id: sensor.unifi_gateway_www
      friendly_name: Upload
      unit_of_measurement: MB/s
      value_template: "{{ state_attr('sensor.unifi_gateway_www','xput_up') | default(0) }}"
    unifi_speedtest_ping:
      #      entity_id: sensor.unifi_gateway_www
      friendly_name: Ping
      unit_of_measurement: ms
      value_template: "{{ state_attr('sensor.unifi_gateway_www','speedtest_ping') | default(0) }}"
    unifi_wlan_user:
      #      entity_id: sensor.unifi_gateway_wlan
      friendly_name: WLAN User
      unit_of_measurement: devices
      value_template: "{{ states.sensor.unifi_gateway_wlan.attributes.num_user | default(0) }}"
    unifi_wlan_guest:
      #      entity_id: sensor.unifi_gateway_wlan
      friendly_name: WLAN Guests
      unit_of_measurement: devices
      value_template: "{{ states.sensor.unifi_gateway_wlan.attributes.num_guest | default(0) }}"
    unifi_wlan_iot:
      #      entity_id: sensor.unifi_gateway_wlan
      friendly_name: WLAN IoT
      unit_of_measurement: devices
      value_template: "{{ states.sensor.unifi_gateway_wlan.attributes.num_iot | default(0) }}"
    sun_sunset:
      #      entity_id: sun.sun
      friendly_name: Sonnenuntergang
      value_template: "{{ state_attr('sun.sun','next_dusk') }}"
    sun_sunrise:
      #      entity_id: sun.sun
      friendly_name: Sonnenaufgang
      value_template: "{{ state_attr('sun.sun','next_dawn') }}"
    proximity_dir_of_travel:
      #      entity_id: proximity.home
      friendly_name: Direction of travel
      value_template: "{{ state_attr('proximity.home','dir_of_travel') }}"
    btc_exchange_rate_in_euro:
      value_template: "{{ ((states.sensor.btc_exchange_rate.state | float) / (states.sensor.eur_exchange_rate.state | float)) | round(2)}}"
      friendly_name: BTC Exchange Rate (EUR)
      unit_of_measurement: EUR
#    coinbase_vault_in_euro:
#      friendly_name: Coinbase BTC Vault (EUR)
#      unit_of_measurement: EUR
#      value_template: "{{ state_attr('sensor.coinbase_btc_vault','Balance in native currency')|replace('EUR','') }}"
#    coinbase_wallet_in_euro:
#      friendly_name: Coinbase BTC Wallet (EUR)
#      unit_of_measurement: EUR
#      value_template: "{{ state_attr('sensor.coinbase_btc_wallet','Balance in native currency')|replace('EUR','') }}"
#    coinbase_vault_xlm_in_euro:
#      value_template: "{{ state_attr('sensor.coinbase_xlm_vault','Balance in native currency')|replace('EUR','') }}"
#      friendly_name: Coinbase XLM Vault (EUR)
#      unit_of_measurement: EUR
#    coinbase_wallet_xlm_in_euro:
#      value_template: "{{ state_attr('sensor.coinbase_xlm_wallet','Balance in native currency')|replace('EUR','') }}"
#      friendly_name: Coinbase XLM Wallet (EUR)
#      unit_of_measurement: EUR
#    coinbase_deposit:
#      value_template: "{{ ((states.sensor.coinbase_vault_in_euro.state | float) + (states.sensor.coinbase_wallet_in_euro.state | float) + (states.sensor.coinbase_eur_wallet.state | float) + (states.sensor.coinbase_wallet_xlm_in_euro.state | float) + (states.sensor.coinbase_vault_xlm_in_euro.state | float)) | round(2)}}"
#      friendly_name: Coinbase Deposit (EUR)
#      unit_of_measurement: EUR
    energy_combined_current:
      value_template: "{{ ((states.sensor.sonoff_pow_r2_tv_current.state | float) + (states.sensor.sonoff_pow_r2_whz_current.state | float)) | round(3) }}"
      friendly_name: Energy combined current
      unit_of_measurement: A
    energy_combined_power:
      value_template: "{{ ((states.sensor.sonoff_pow_r2_tv_power.state | float) + (states.sensor.sonoff_pow_r2_whz_power.state | float)) | round(2) }}"
      friendly_name: Energy combined power
      device_class: power
      unit_of_measurement: W
    energy_combined_voltage:
      value_template: "{{ (((states.sensor.sonoff_pow_r2_tv_voltage.state | float) + (states.sensor.sonoff_pow_r2_whz_voltage.state | float)) / 2) | round(2) }}"
      friendly_name: Energy combined voltage
      unit_of_measurement: V
    energy_consumed_hourly_combined:
      unit_of_measurement: kWh
      value_template: "{{ ((states.sensor.energy_consumed_hourly_whz_1.state | float) + (states.sensor.energy_consumed_hourly_whz_2.state | float)) | round(2) }}"
    energy_consumed_daily_combined:
      unit_of_measurement: kWh
      value_template: "{{ ((states.sensor.energy_consumed_daily_whz_1.state | float) + (states.sensor.energy_consumed_daily_whz_2.state | float)) | round(2) }}"
    energy_consumed_weekly_combined:
      unit_of_measurement: kWh
      value_template: "{{ ((states.sensor.energy_consumed_weekly_whz_1.state | float) + (states.sensor.energy_consumed_weekly_whz_2.state | float)) | round(2) }}"
    energy_consumed_monthly_combined:
      unit_of_measurement: kWh
      value_template: "{{ ((states.sensor.energy_consumed_monthly_whz_1.state | float) + (states.sensor.energy_consumed_monthly_whz_2.state | float)) | round(2) }}"
    energy_consumed_yearly_combined:
      unit_of_measurement: kWh
      value_template: "{{ ((states.sensor.energy_consumed_yearly_whz_1.state | float) + (states.sensor.energy_consumed_yearly_whz_2.state | float)) | round(2) }}"
    thermostat_wohnzimmer_wifi_signal:
      friendly_name: Thermostat Wohnzimmer WiFi Signal
      value_template: "{{ states.sensor.wiser_itrv_wohnzimmer.attributes.controller_reception_RSSI | default(0) | int if states.sensor.wiser_itrv_wohnzimmer.attributes.controller_reception_RSSI is not none}}"
      device_class: signal_strength
      unit_of_measurement: dB
    thermostat_bad_wifi_signal:
      friendly_name: Thermostat Bad WiFi Signal
      value_template: "{{ states.sensor.wiser_itrv_bad.attributes.controller_reception_RSSI | default(0) | int if states.sensor.wiser_itrv_bad.attributes.controller_reception_RSSI is not none}}"
      device_class: signal_strength
      unit_of_measurement: dB
    thermostat_flur_wifi_signal:
      friendly_name: Thermostat Flur WiFi Signal
      value_template: "{{ states.sensor.wiser_itrv_flur.attributes.controller_reception_RSSI | default(0) | int if states.sensor.wiser_itrv_flur.attributes.controller_reception_RSSI is not none}}"
      device_class: signal_strength
      unit_of_measurement: dB
    roomstat_wohnzimmer_wifi_signal:
      friendly_name: Raum Thermostat WiFi Signal
      value_template: "{{ states.sensor.wiser_roomstat_wohnzimmer.attributes.controller_reception_RSSI | default(0) | int if states.sensor.wiser_roomstat_wohnzimmer.attributes.controller_reception_RSSI is not none}}"
      device_class: signal_strength
      unit_of_measurement: dB
    heathub_wifi_signal:
      friendly_name: Heathub WiFi Signal
      value_template: "{{ states.sensor.wiser_heathub.attributes.controller_reception_RSSI | default(0) | int if states.sensor.wiser_heathub.attributes.controller_reception_RSSI is not none}}"
      device_class: signal_strength
      unit_of_measurement: dB
    climate_thermostat_bad_battery_level:
      friendly_name: Thermostat Bad
      value_template: "{{ states('sensor.wiser_itrv_bad_battery_level') | default(101) | int if states('sensor.wiser_itrv_bad_battery_level') is not none}}"
      unit_of_measurement: "%"
      device_class: battery
    climate_thermostat_flur_battery_level:
      friendly_name: Thermostat Flur
      value_template: "{{ states('sensor.wiser_itrv_flur_battery_level') | default(101) | int if states('sensor.wiser_itrv_flur_battery_level') is not none}}"
      unit_of_measurement: "%"
      device_class: battery
    climate_thermostat_wohnzimmer_battery_level:
      friendly_name: Thermostat Wohnzimmer
      value_template: "{{ states('sensor.wiser_itrv_wohnzimmer_battery_level') | default(101) | int if states('sensor.wiser_itrv_wohnzimmer_battery_level') is not none}}"
      unit_of_measurement: "%"
      device_class: battery
    climate_raumthermostat_wohnzimmer_battery_level:
      friendly_name: Raum Thermostat Wohnzimmer
      value_template: "{{ states('sensor.wiser_roomstat_wohnzimmer_battery_level') | default(101) | int if states('sensor.wiser_roomstat_wohnzimmer_battery_level') is not none}}"
      unit_of_measurement: "%"
      device_class: battery
    google_pixel_battery_level:
      value_template: "{{ states.device_tracker.google_pixel.attributes.battery | default(101) | int if states.device_tracker.google_pixel.attributes.battery is not none}}"
      friendly_name: Goolge Pixel Akku
      #      entity_id: device_tracker.google_pixel
      unit_of_measurement: "%"
      device_class: battery
    google_nexus_battery_level:
      value_template: "{{ states.sensor.nexus_battery_level.state | default(101) | int if states.sensor.nexus_battery_level.state is not none}}"
      friendly_name: Goolge Nexus Akku
      #      entity_id: device_tracker.google_nexus
      unit_of_measurement: "%"
      device_class: battery
    macbook_air_battery_level:
      value_template: "{{ states.device_tracker.macbook_air.attributes.battery | default(101) | int if states.device_tracker.macbook_air.attributes.battery is not none}}"
      friendly_name: MacBook Air Akku
      #      entity_id: device_tracker.macbook_air
      unit_of_measurement: "%"
      device_class: battery
    #    date_muellabfuhr:
    #      friendly_name: Müllabfuhr
    #      value_template: "{{ states.calendar.mullabfuhr.attributes.start_time }}"
    heating_time_bad:
      friendly_name: Heating Time Bad
      icon_template: mdi:radiator
      value_template: "{{ states('sensor.heating_bad_on_today') | float * 60 }}"
      unit_of_measurement: min
    heating_time_flur:
      friendly_name: Heating Time Flur
      icon_template: mdi:radiator
      value_template: "{{ states('sensor.heating_flur_on_today') | float * 60 }}"
      unit_of_measurement: min
    heating_time_wohnzimmer:
      friendly_name: Heating Time Wohnzimmer
      icon_template: mdi:radiator
      value_template: "{{ states('sensor.heating_wohnzimmer_on_today') | float * 60 }}"
      unit_of_measurement: min
    #    low_battery:
    #      friendly_name: "Low Battery"
    #      value_template: >
    #        {%- set threshold = 40 -%}
    #        {%- set domains = ['light', 'switch', 'sensor', 'climate', 'lock'] -%}
    #        {%- for domain in domains -%}
    #        {%- for item in states[domain] if ((item.attributes.battery_level is defined and item.attributes['battery_level'] | int < threshold) or ("battery" in item.name | lower and ((item.state | int < threshold and item.state|int != 0) or item.state | lower == "low" or item.state | lower == "unknown"))) -%}
    #            {{ item.attributes.friendly_name }}{%- if not loop.last %}, {% endif -%}
    #        {%- endfor -%}
    #        {%- endfor -%}
    hass_uptime:
      #      entity_id:
      #        - sensor.time
      value_template: >
        {%- set dt = strptime(states('sensor.last_boot'),"%Y-%m-%dT%H:%M:%S%z") %}
        {%- set time =  (now().timestamp() - dt.timestamp()) | int %}
        {%- set minutes = ((time % 3600) // 60) %}
        {%- set minutes = '{}min'.format(minutes) if minutes > 0 else '' %}
        {%- set hours = ((time % 86400) // 3600) %}
        {%- set hours = '{}hr '.format(hours) if hours > 0 else '' %}
        {%- set days = (time // 86400) %}
        {%- set days = '{}d '.format(days) if days > 0 else '' %}
        {{ 'Less than 1 min' if time < 60 else days + hours + minutes }}
    outside_temperature:
      friendly_name: Außentemperatur
      value_template: >
        {{ state_attr('weather.dark_sky', 'temperature') | default(0) | int if states.weather.dark_sky.attributes.temperature is not none }}
      unit_of_measurement: "°C"
      device_class: temperature
    internet_uptime:
      friendly_name: Verbunden
      value_template: >
        {{ as_timestamp(states.sensor.home_phixion_org.last_changed) | timestamp_custom('%c') }}
    core_mem:
      friendly_name: Core Memory Usage
      unit_of_measurement: "%"
      value_template: "{{ state_attr('sensor.core', 'memory_percent') }}"
    supervisor_mem:
      friendly_name: Supervisor Memory Usage
      unit_of_measurement: "%"
      value_template: "{{ state_attr('sensor.supervisor', 'memory_percent') }}"

- platform: filter
  filters:
    - filter: time_throttle
      window_size: 00:01
  name: InfluxDB Homeassistant Size
  entity_id: sensor.influxdb_size_homeassistant
- platform: filter
  filters:
    - filter: time_throttle
      window_size: 00:01
  name: InfluxDB Internal Size
  entity_id: sensor.influxdb_size_internal
- platform: filter
  filters:
    - filter: time_throttle
      window_size: 00:01
  name: InfluxDB UniFi Size
  entity_id: sensor.influxdb_size_unifi
- platform: filter
  filters:
    - filter: time_throttle
      window_size: 00:01
  name: Sonoff POW WHZ Power
  entity_id: sensor.sonoff_pow_r2_whz_power
- platform: filter
  filters:
    - filter: time_throttle
      window_size: 00:01
  name: Sonoff POW WHZ Current
  entity_id: sensor.sonoff_pow_r2_whz_current
- platform: filter
  filters:
    - filter: time_throttle
      window_size: 00:01
  name: Sonoff POW WHZ Voltage
  entity_id: sensor.sonoff_pow_r2_whz_voltage
- platform: filter
  filters:
    - filter: time_throttle
      window_size: 00:01
  name: Sonoff POW TV Power
  entity_id: sensor.sonoff_pow_r2_tv_power
- platform: filter
  filters:
    - filter: time_throttle
      window_size: 00:01
  name: Sonoff POW TV Current
  entity_id: sensor.sonoff_pow_r2_tv_current
- platform: filter
  filters:
    - filter: time_throttle
      window_size: 00:01
  name: Sonoff POW TV Voltage
  entity_id: sensor.sonoff_pow_r2_tv_voltage
- platform: filter
  filters:
    - filter: time_throttle
      window_size: 00:01
  name: Sonoff POW Combined Power
  entity_id: sensor.energy_combined_power
- platform: filter
  filters:
    - filter: time_throttle
      window_size: 00:01
  name: Sonoff POW Combined Current
  entity_id: sensor.energy_combined_current
- platform: filter
  filters:
    - filter: time_throttle
      window_size: 00:01
  name: Sonoff POW Combined Voltage
  entity_id: sensor.energy_combined_voltage
- platform: filter
  name: "Temperatur Wohnzimmer Thermostat (Filtered)"
  entity_id: sensor.climate_wohnzimmer_temp
  filters:
    - filter: outlier
      window_size: 4
      radius: 2.0
    - filter: lowpass
      time_constant: 10
    - filter: time_simple_moving_average
      window_size: 00:05
      precision: 2
- platform: filter
  name: "Temperatur Bad Thermostat (Filtered)"
  entity_id: sensor.climate_bad_temp
  filters:
    - filter: outlier
      window_size: 4
      radius: 2.0
    - filter: lowpass
      time_constant: 10
    - filter: time_simple_moving_average
      window_size: 00:05
      precision: 2
- platform: filter
  name: "Temperatur Flur Thermostat (Filtered)"
  entity_id: sensor.climate_flur_temp
  filters:
    - filter: outlier
      window_size: 4
      radius: 2.0
    - filter: lowpass
      time_constant: 10
    - filter: time_simple_moving_average
      window_size: 00:05
      precision: 2
- platform: qnap
  host: !secret qnap_host # pragma: allowlist secret
  username: !secret qnap_usr # pragma: allowlist secret
  password: !secret qnap_pwd # pragma: allowlist secret
  ssl: true
  verify_ssl: false
  port: 443
  monitored_conditions:
    - status
    - cpu_usage
    - memory_percent_used
    - network_tx
    - volume_percentage_used
- platform: history_stats
  name: Heating Bad On Today
  entity_id: binary_sensor.heating_bad
  state: "on"
  type: time
  end: "{{ now().replace(hour=0, minute=0, second=0) }}"
  duration:
    days: 1
- platform: history_stats
  name: Heating Flur On Today
  entity_id: binary_sensor.heating_flur
  state: "on"
  type: time
  end: "{{ now().replace(hour=0, minute=0, second=0) }}"
  duration:
    days: 1
- platform: history_stats
  name: Heating Wohnzimmer On Today
  entity_id: binary_sensor.heating_wohnzimmer
  state: "on"
  type: time
  end: "{{ now().replace(hour=0, minute=0, second=0) }}"
  duration:
    days: 1
- platform: history_stats
  name: Heating Bad On Yesterday
  entity_id: binary_sensor.heating_bad
  state: "on"
  type: time
  end: "{{ now().replace(hour=0, minute=0, second=0) }}"
  duration:
    days: 2
- platform: history_stats
  name: Heating Flur On Yesterday
  entity_id: binary_sensor.heating_flur
  state: "on"
  type: time
  end: "{{ now().replace(hour=0, minute=0, second=0) }}"
  duration:
    days: 2
- platform: history_stats
  name: Heating Wohnzimmer On Yesterday
  entity_id: binary_sensor.heating_wohnzimmer
  state: "on"
  type: time
  end: "{{ now().replace(hour=0, minute=0, second=0) }}"
  duration:
    days: 2
- platform: history_stats
  name: Heating Bad On this Week
  entity_id: binary_sensor.heating_bad
  state: "on"
  type: time
  start: "{{ as_timestamp( now().replace(hour=0, minute=0, second=0) ) - now().weekday() * 86400 }}"
  end: "{{ now() }}"
- platform: history_stats
  name: Heating Flur On this Week
  entity_id: binary_sensor.heating_flur
  state: "on"
  type: time
  start: "{{ as_timestamp( now().replace(hour=0, minute=0, second=0) ) - now().weekday() * 86400 }}"
  end: "{{ now() }}"
- platform: history_stats
  name: Heating Wohnzimmer On this Week
  entity_id: binary_sensor.heating_wohnzimmer
  state: "on"
  type: time
  start: "{{ as_timestamp( now().replace(hour=0, minute=0, second=0) ) - now().weekday() * 86400 }}"
  end: "{{ now() }}"
- platform: history_stats
  name: Heating Bad On past 30 days
  entity_id: binary_sensor.heating_bad
  state: "on"
  type: time
  end: "{{ now().replace(hour=0, minute=0, second=0) }}"
  duration:
    days: 30
- platform: history_stats
  name: Heating Flur On past 30 days
  entity_id: binary_sensor.heating_flur
  state: "on"
  type: time
  end: "{{ now().replace(hour=0, minute=0, second=0) }}"
  duration:
    days: 30
- platform: history_stats
  name: Heating Wohnzimmer On past 30 days
  entity_id: binary_sensor.heating_wohnzimmer
  state: "on"
  type: time
  end: "{{ now().replace(hour=0, minute=0, second=0) }}"
  duration:
    days: 30
#- platform: scrape
#  #  scan_interval: 10000000
#  name: wtfisxur
#  resource: https://wherethefuckisxur.com/
#  select: "h1.page-title"
#- platform: scrape
#  scan_interval: 10000000
#  name: wtfnf
#  resource: https://wherethefuckisxur.com/data/currentcycles
#  select: "ul.nightfalls"
#- platform: scrape
#  scan_interval: 120
#  name: div2dailies
#  resource: https://division.zone/the-division-2/reset-timers/
#  select: 'div.inner h2'
- platform: darksky
  api_key: !secret weatherdarkskyapi_pwd # pragma: allowlist secret
  units: auto
  language: de
  monitored_conditions:
    - alerts
    - summary
    - precip_type
    - precip_intensity
    - precip_probability
    - precip_accumulation
    - temperature
    - apparent_temperature
    - dew_point
    - wind_speed
    - wind_bearing
    - cloud_cover
    - humidity
    - pressure
    - visibility
    - ozone
    - temperature_high
    - temperature_low
    - apparent_temperature_high
    - apparent_temperature_low
    - precip_intensity_max
    - uv_index
    - moon_phase
- platform: google_fit_hass
  scan_interval: 14400
  name: Google Fit Martin
  client_id: !secret google_fit_id # pragma: allowlist secret
  client_secret: !secret google_fit_secret # pragma: allowlist secret
- platform: google_travel_time
  scan_interval: 1000000
  name: Travel Parents (Trains)
  api_key: !secret google_assistantapikey_pwd # pragma: allowlist secret
  origin: device_tracker.google_pixel
  destination: zone.mum_dad
  options:
    mode: transit
    transit_mode: train
    transit_routing_preference: fewer_transfers
- platform: google_travel_time
  scan_interval: 1000000
  name: Travel Parents (Bike)
  api_key: !secret google_assistantapikey_pwd # pragma: allowlist secret
  origin: device_tracker.google_pixel
  destination: zone.mum_dad
  options:
    mode: bicycling
- platform: google_travel_time
  scan_interval: 1000000
  name: Commute Home
  api_key: !secret google_assistantapikey_pwd # pragma: allowlist secret
  origin: device_tracker.google_pixel
  destination: zone.home
- platform: snmp
  host: !secret unifi_usg # pragma: allowlist secret
  name: UniFi USG Uptime
  baseoid: 1.3.6.1.2.1.1.3.0
  value_template: >
    {%- set time = value | int // 100 %}
    {%- set minutes = ((time % 3600) // 60) %}
    {%- set minutes = '{}min'.format(minutes) if minutes > 0 else '' %}
    {%- set hours = ((time % 86400) // 3600) %}
    {%- set hours = '{}hr '.format(hours) if hours > 0 else '' %}
    {%- set days = (time // 86400) %}
    {%- set days = '{}d '.format(days) if days > 0 else '' %}
    {{ 'Less than 1 min' if time < 60 else days + hours + minutes }}
- platform: snmp
  host: !secret unifi_switch # pragma: allowlist secret
  name: UniFi Switch Uptime
  baseoid: 1.3.6.1.2.1.1.3.0
  value_template: >
    {%- set time = value | int // 100 %}
    {%- set minutes = ((time % 3600) // 60) %}
    {%- set minutes = '{}min'.format(minutes) if minutes > 0 else '' %}
    {%- set hours = ((time % 86400) // 3600) %}
    {%- set hours = '{}hr '.format(hours) if hours > 0 else '' %}
    {%- set days = (time // 86400) %}
    {%- set days = '{}d '.format(days) if days > 0 else '' %}
    {{ 'Less than 1 min' if time < 60 else days + hours + minutes }}
- platform: snmp
  host: !secret unifi_ap # pragma: allowlist secret
  name: UniFi Accesspoint Uptime
  baseoid: 1.3.6.1.2.1.1.3.0
  value_template: >
    {%- set time = value | int // 100 %}
    {%- set minutes = ((time % 3600) // 60) %}
    {%- set minutes = '{}min'.format(minutes) if minutes > 0 else '' %}
    {%- set hours = ((time % 86400) // 3600) %}
    {%- set hours = '{}hr '.format(hours) if hours > 0 else '' %}
    {%- set days = (time // 86400) %}
    {%- set days = '{}d '.format(days) if days > 0 else '' %}
    {{ 'Less than 1 min' if time < 60 else days + hours + minutes }}
- platform: snmp
  host: !secret qnap_host # pragma: allowlist secret
  name: NAS Uptime
  baseoid: 1.3.6.1.2.1.1.3.0
  value_template: >
    {%- set time = value | int // 100 %}
    {%- set minutes = ((time % 3600) // 60) %}
    {%- set minutes = '{}min'.format(minutes) if minutes > 0 else '' %}
    {%- set hours = ((time % 86400) // 3600) %}
    {%- set hours = '{}hr '.format(hours) if hours > 0 else '' %}
    {%- set days = (time // 86400) %}
    {%- set days = '{}d '.format(days) if days > 0 else '' %}
    {{ 'Less than 1 min' if time < 60 else days + hours + minutes }}
- platform: snmp
  host: !secret hp_switch # pragma: allowlist secret
  name: HP Switch Uptime
  baseoid: 1.3.6.1.2.1.1.3.0
  value_template: >
    {%- set time = value | int // 100 %}
    {%- set minutes = ((time % 3600) // 60) %}
    {%- set minutes = '{}min'.format(minutes) if minutes > 0 else '' %}
    {%- set hours = ((time % 86400) // 3600) %}
    {%- set hours = '{}hr '.format(hours) if hours > 0 else '' %}
    {%- set days = (time // 86400) %}
    {%- set days = '{}d '.format(days) if days > 0 else '' %}
    {{ 'Less than 1 min' if time < 60 else days + hours + minutes }}
#nexpo
- platform: youtube
  channel_id: UCpFFItkfZz1qz5PpHpqzYBw
#frenck
- platform: youtube
  channel_id: UCZ2Ku6wrhdYDHCaBzLaA3bw
#scaretheatre
- platform: youtube
  channel_id: UCaGOgwGKnDVOKY0DrFsBAiA
#h3h3podcast
#- platform: youtube
#  channel_id: UCLtREJY21xRfCuEKvdki1Kw
#reignbot
- platform: youtube
  channel_id: UCchWU8ta6L-Dy3rGIxPINzw
#internet historian
- platform: youtube
  channel_id: UCR1D15p_vdP3HkrH8wgjQRw
#cheese forever
- platform: youtube
  channel_id: UCl1M49CAo9u99gABBIqEgDQ
- platform: time_date
  display_options:
    - "time"
    - "time_date"
    - "date_time"
    - "date_time_iso"
    - "date"
    - "time_utc"
- platform: websocket_api
#- platform: serial
#  serial_port: /dev/ttyUSB1
#  baudrate: 9600
#- platform: myjdownloader
#  email: !secret jd_user
#  password: !secret jd_passwd
- platform: waste_collection_schedule
  source_index: 0
  name: Müllabfuhr
  details_format: upcoming
  count: 10
  leadtime: 10
  value_template: '{{value.types|join(", ")}} am {{value.date.strftime("%a, %d.%m.%Y")}}'
#- platform: email
#  email: !secret gmail_phixion_user
#  password: !secret gmail_phixion_pwd
#- platform: email
#  email: !secret gmail_ridelore_user
#  password: !secret gmail_ridelore_pwd
#- platform: email
#  email: !secret gmail_monitoring_user
#  password: !secret gmail_monitoring_pwd
#https://www.home-assistant.io/integrations/rest/
- platform: rest
  resource: !secret supervisor_rest_api
  name: core
  unit_of_measurement: "%"
  value_template: "{{ value_json.data.cpu_percent }}"
  scan_interval: 10
  headers:
    Authorization: !secret llt
    Content-Type: application/json
  json_attributes_path: "$.data"
  json_attributes:
    - memory_percent
- platform: rest
  resource: !secret supervisor_rest_api
  name: supervisor
  unit_of_measurement: "%"
  value_template: "{{ value_json.data.cpu_percent }}"
  scan_interval: 10
  headers:
    Authorization: !secret llt
    Content-Type: application/json
  json_attributes_path: "$.data"
  json_attributes:
    - memory_percent
- platform: rest
  name: Where the fuck is Xur
  json_attributes:
    - desc
    - found
    - img
    - lastUpdate
    - planet
    - present
    - zone
  resource: !secret xur_rest_api
  value_template: "{{ value_json.present }}"
#- platform: template
#  sensors:
#    where_the_fuck_is_xur:
#      value_template: "{{ value_json.xur }}"
#      entity_picture_template: "{{ 'https://wherethefuckisxur.com'+state_attr('value_json.xur', 'img')}}"
- platform: rest
  name: Club Status
  json_attributes:
    - space
    - url
    - state
    - location
    - feeds
    - logo
  resource: !secret muccc_spaceapi
  value_template: "{{ value_json.state.message }}"
  headers:
    Accept: application/json
    Content-Type: application/json
    User-Agent: hassio REST sensor (msg rid@muccc irc if concerns)
#- platform: rest
#  name: Homeassistant Alerts
#  json_attributes:
#    - title
#    - created
#    - updated
#    - integrations
#    - packages
#    - github_issue
#    - homeassistant
#    - filename
#    - alert_url
#  resource: https://alerts.home-assistant.io/alerts.json
#  value_template: "{{ value_json.title }}"
#  headers:
#    Accept: application/json
#    Content-Type: application/json
  #- platform: rest
#  name: Steam Status
#  json_attributes:
#    - psa
#    - services
#    - graph
#    - time
#    - online
#  resource: !secret steamstatus_api
#  value_template: "{{ value_json.online }}"
#  unit_of_measurement: "%"
#  headers:
#    Accept: application/json
#    Content-Type: application/json
#    User-Agent: hassio REST sensor (msg phixion@freenode if concerns)
